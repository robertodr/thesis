% mainfile: ../RobertoDiRemigioPhDThesis.tex
%************************************************
\chapter{Treating solvation within correlated wave function models}\label{ch:PCMCC}

\epigraph{Non temerai i terrori della notte non temerai il terrore}{--- \textsc{CCCP}}

In this Chapter, I will summarize previous and current work on the
formulation of quantum/classical polarizable models in the context of
the highly accurate \acl{CC} model.
This is an ongoing and yet unpublished collaboration with prof.~T.~Daniel Crawford
(Virginia Tech) and Dr.~Andrew C.~Simmonett (NIH)
The first part of this Chapter summarizes existing work, mainly by Cammi
and Caricato, by recasting it in language of variational
quantum/classical polarizable Hamiltonians.
The second part of this Chapter illustrates how the variational language
facilitates the formulation of a \acl{CC}-based \acl{PT} (\acs{CC}-\acs{PT})
including a classical polarizable environment.
I will finally show how the perturbation series can be successfully
exploited to derive iterative and noniterative approximate \acs{CC}
schemes.

\pagebreak

\section{Notation}
Cluster operator:
\begin{equation}
  T = \sum_{i=1}^\mathcal{M}\sum_{\mu_i}\tamp{\mu_i}\cluster{\mu_i}
\end{equation}
$\mu_i$ is the $\mu$-th excitation at the $i$-th
excitation level and $\mathcal{M}$ is the truncation level.

The term at the $j$-th excitation level in the left CC wavefunction:
\begin{equation}
  \bra{\tbar{j}} = \sum_{\mu_j}\tbar{\mu_j}\bra{\mu_j}
\end{equation}

\acl{MP} partitioning:
\begin{equation}
 H_0 = F + \Phi = \sum_P\epsilon_P\cons{P}\anni{P} + (g- V_\mathrm{HF})
\end{equation}
where $F$ if the Fock matrix and $\Phi$ is the fluctuation potential.
We assume to deal with an \acl{HF} (\acs{HF}) reference function.

Similarity transformed operator:
\begin{equation}
  \overline{O} =\expo{-T}O\expo{T}
\end{equation}
Since the Fock operator is diagonal, its similarity transformation
truncates after the second term:
\begin{equation}
  \overline{F} = F + \sum_{i}^4\sum_{\mu_i}\tamp{\mu_i}\cluster{\mu_i}\denom{\mu_i}
\end{equation}
where $\denom{\mu_i}$ is the difference in orbital energy between the
virtual and occupied spin-orbitals of excitation $i$.
For the fluctuation potential the similarity transformation truncates
after the fifth term, \ie{} includes up to four-fold nested commutators
with the cluster operator.

\acs{CC} expectation values are formed using the left and
right \acs{CC} states and are denoted as:
\begin{equation}
  O(\tamp{}, \tbar{}) = \braket{\mathrm{HF} | \overline{O} | \mathrm{HF} }
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{j} | \overline{O} | \mathrm{HF} }
\end{equation}
We will also use the notation $O^\mathcal{M}(\tamp{}, \tbar{})$ to
denote a \acs{CC} expectation value truncated at the $\mathcal{M}$-th
excitation level.

\section{Effective Coupled Cluster Lagrangian}

The effective CC Lagrangian can be readily obtained by coupling the
usual CC Lagrangian with the classical polarization functional.
Care must however be taken in the definition of the classical
variational degrees of freedom as to not erroneously include
contributions from the reference state in the subsequent correlated
treatment.

Let us assume that the reference state is the optimized single \acs{HF}
determinant in the presence of the implicit/explicit environment.
Then the corresponding variational degrees of freedom satisfy:
\begin{equation}
  \begin{pmatrix}
    \PCM & \MMPCM^\dagger \\
    \MMPCM & \MM
  \end{pmatrix}
  \begin{pmatrix}
   \sigma^\mathrm{HF} \\
   \kappa^\mathrm{HF}
  \end{pmatrix}
  =
  -
  \begin{pmatrix}
   \esp^\mathrm{HF} \\
   \zeta^\mathrm{HF}
  \end{pmatrix}
\end{equation}
and correspond to the \emph{reference reaction field}.
In the subsequent correlated treatment one can separate the reaction
field into reference and correlated components:
\begin{equation}
  \begin{pmatrix}
   \sigma^\mathrm{tot} \\
   \kappa^\mathrm{tot}
  \end{pmatrix}
  =
  \begin{pmatrix}
   \sigma^\mathrm{HF} \\
   \kappa^\mathrm{HF}
  \end{pmatrix}
  +
  \begin{pmatrix}
   \sigma \\
   \kappa
  \end{pmatrix}
\end{equation}
and similarly for the sources:
\begin{equation}
  \begin{pmatrix}
   \esp(\tamp{}, \tbar{}) \\
   \zeta(\tamp{}, \tbar{})
  \end{pmatrix}
  =
  \begin{pmatrix}
   \esp^\mathrm{HF} \\
   \zeta^\mathrm{HF}
  \end{pmatrix}
  +
  \begin{pmatrix}
    \tilde{\esp}(\tamp{}, \tbar{}) \\
   \tilde{\zeta}(\tamp{}, \tbar{})
  \end{pmatrix}
  =
  \begin{pmatrix}
  \braket{\mathrm{HF} | \esp  | \mathrm{HF}} \\
  \braket{\mathrm{HF} | \zeta | \mathrm{HF}}
  \end{pmatrix}
  +
  \begin{pmatrix}
   \braket{\mathrm{HF} | \tilde{\esp} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{\esp} | \mathrm{HF}} \\
   \braket{\mathrm{HF} | \tilde{\zeta} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{\zeta} | \mathrm{HF}}
  \end{pmatrix}
\end{equation}
The Baker--Campbell--Hausdorff expansions of the source terms have been
rewritten as:
\begin{equation}
  \overline{\s} = \s + \tilde{\s} = \s + \commutator{\s}{T}
  + \frac{1}{2}\commutator{\commutator{\s}{T}}{T}
\end{equation}
taking advantage of the fact that $\s$ is a one-electron operator and
hence its commutator expansion truncates at the third term.
We apply a shift to the correlation part of the source term
one-electron operator to remove the reference source terms:
\begin{equation}
  \begin{aligned}
  \begin{pmatrix}
   \braket{\mathrm{HF} | \tilde{\esp} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \tilde{\esp} | \mathrm{HF}} \\
   \braket{\mathrm{HF} | \tilde{\zeta} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \tilde{\zeta} | \mathrm{HF}}
  \end{pmatrix}
  &=
  \begin{pmatrix}
    \braket{\mathrm{HF} | \overline{\esp} - \esp^\mathrm{HF} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{\esp} - \esp^\mathrm{HF} | \mathrm{HF}} \\
  \braket{\mathrm{HF} | \overline{\zeta} - \zeta^\mathrm{HF} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{\zeta} -
  \zeta^\mathrm{HF}| \mathrm{HF}}
  \end{pmatrix}
  \\
  &=
  \begin{pmatrix}
   \braket{\mathrm{HF} | \tilde{\esp} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{\esp} | \mathrm{HF}} \\
   \braket{\mathrm{HF} | \tilde{\zeta} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{\zeta} | \mathrm{HF}}
  \end{pmatrix}
  =
  \begin{pmatrix}
    \tilde{\esp}(\tamp{}, \tbar{}) \\
    \tilde{\zeta}(\tamp{}, \tbar{})
  \end{pmatrix}
\end{aligned}
\end{equation}
which is equivalent to imposing normal ordering of the
operators.~\autocite{Shavitt}
The total functional will include both reference and correlation
components:
\begin{equation}
  \begin{aligned}
  U_\mathrm{pol} &=
  \frac{1}{2}(\sigma^\mathrm{HF}+\sigma)\PCM(\sigma^\mathrm{HF}+\sigma)
+ (\sigma^\mathrm{HF}+\sigma)(\esp^\mathrm{HF}+\tilde{\esp}(\tamp{},\tbar{})) \\
&+ \frac{1}{2}(\kappa^\mathrm{HF}+\kappa)\MM(\kappa^\mathrm{HF}+\kappa)
+ (\kappa^\mathrm{HF}+\kappa)(\zeta^\mathrm{HF}+\tilde{\zeta}(\tamp{},\tbar{})) \\
&+ (\sigma^\mathrm{HF}+\sigma)\bi{X}(\kappa^\mathrm{HF}+\kappa)
  %%%% Steps
= \left/ \text{Expand and collect} \right/ \\
&=
    \frac{1}{2}\sigma^\mathrm{HF}\PCM\sigma^\mathrm{HF}
  + \sigma^\mathrm{HF}\esp^\mathrm{HF}
  + \frac{1}{2}\kappa^\mathrm{HF}\MM\kappa^\mathrm{HF}
  + \kappa^\mathrm{HF}\zeta^\mathrm{HF}
  + \sigma^\mathrm{HF}\bi{X}\kappa^\mathrm{HF} \\
&+  \frac{1}{2}\sigma\PCM\sigma
  + \sigma\tilde{\esp}(\tamp{},\tbar{})
  + \frac{1}{2}\kappa\MM\kappa
  + \kappa\tilde{\zeta}(\tamp{},\tbar{})
  + \sigma\bi{X}\kappa \\
&+  \frac{1}{2}\sigma^\mathrm{HF}\PCM\sigma
  + \sigma^\mathrm{HF}\tilde{\esp}(\tamp{},\tbar{})
  + \frac{1}{2}\kappa^\mathrm{HF}\MM\kappa
  + \kappa^\mathrm{HF}\tilde{\zeta}(\tamp{},\tbar{})
  + \sigma^\mathrm{HF}\bi{X}\kappa \\
&+  \frac{1}{2}\sigma\PCM\sigma^\mathrm{HF}
  + \sigma\esp^\mathrm{HF}
  + \frac{1}{2}\kappa\MM\kappa^\mathrm{HF}
  + \kappa\zeta^\mathrm{HF}
  + \sigma\bi{X}\kappa^\mathrm{HF} \\
  %%%% Steps
&= \left/
  \frac{1}{2}\sigma^\mathrm{HF}\PCM\sigma^\mathrm{HF}
  +
  \frac{1}{2}\kappa^\mathrm{HF}\MM\kappa^\mathrm{HF}
  +
  \sigma^\mathrm{HF}\esp^\mathrm{HF}
  +
  \kappa^\mathrm{HF}\zeta^\mathrm{HF}
  +
  \sigma^\mathrm{HF}\bi{X}\kappa^\mathrm{HF}
  =
  \frac{1}{2}\sigma^\mathrm{HF}\esp^\mathrm{HF}
  +
  \frac{1}{2}\kappa^\mathrm{HF}\zeta^\mathrm{HF}
  \right/ \\
&=
    \frac{1}{2}\sigma^\mathrm{HF}\esp^\mathrm{HF}
  + \frac{1}{2}\kappa^\mathrm{HF}\zeta^\mathrm{HF} \\
&+  \frac{1}{2}\sigma\PCM\sigma
  + \sigma\tilde{\esp}(\tamp{},\tbar{})
  + \frac{1}{2}\kappa\MM\kappa
  + \kappa\tilde{\zeta}(\tamp{},\tbar{})
  + \sigma\bi{X}\kappa \\
&+  \frac{1}{2}\sigma^\mathrm{HF}\PCM\sigma
  + \sigma^\mathrm{HF}\tilde{\esp}(\tamp{},\tbar{})
  + \frac{1}{2}\kappa^\mathrm{HF}\MM\kappa
  + \kappa^\mathrm{HF}\tilde{\zeta}(\tamp{},\tbar{})
  + \sigma^\mathrm{HF}\bi{X}\kappa \\
&+  \frac{1}{2}\sigma\PCM\sigma^\mathrm{HF}
  + \sigma\esp^\mathrm{HF}
  + \frac{1}{2}\kappa\MM\kappa^\mathrm{HF}
  + \kappa\zeta^\mathrm{HF}
  + \sigma\bi{X}\kappa^\mathrm{HF} \\
  %%%% Steps
&= \left/
  \frac{1}{2}\sigma\PCM\sigma^\mathrm{HF}
  =
  \frac{1}{2}\sigma^\mathrm{HF}\PCM\sigma;\quad
  \frac{1}{2}\kappa\MM\kappa^\mathrm{HF}
  =
  \frac{1}{2}\kappa^\mathrm{HF}\MM\kappa; \quad
  \sigma^\mathrm{HF}\bi{X}\kappa
  =
  \kappa\bi{X}^\dagger\sigma^\mathrm{HF}
  \right/ \\
&=
    \frac{1}{2}\sigma^\mathrm{HF}\esp^\mathrm{HF}
  + \frac{1}{2}\kappa^\mathrm{HF}\zeta^\mathrm{HF} \\
&+  \frac{1}{2}\sigma\PCM\sigma
  + \sigma\tilde{\esp}(\tamp{},\tbar{})
  + \frac{1}{2}\kappa\MM\kappa
  + \kappa\tilde{\zeta}(\tamp{},\tbar{})
  + \sigma\bi{X}\kappa \\
  &+ \sigma(\cancelto{0}{\bi{Y}\sigma^\mathrm{HF} + \bi{X}\kappa^\mathrm{HF} + \esp^\mathrm{HF}})
  + \kappa(\cancelto{0}{\bi{W}\kappa^\mathrm{HF} + \bi{X}^\dagger\sigma^\mathrm{HF} + \zeta^\mathrm{HF}}) \\
&+ \sigma^\mathrm{HF}\tilde{\esp}(\tamp{},\tbar{}) + \kappa^\mathrm{HF}\tilde{\zeta}(\tamp{},\tbar{}) \\
  %%%% Steps
&= \left/
    \frac{1}{2}\sigma^\mathrm{HF}\esp^\mathrm{HF}
  + \frac{1}{2}\kappa^\mathrm{HF}\zeta^\mathrm{HF}
  \coloneqq U_\mathrm{pol}^\mathrm{ref}
  \right/ \\
&=
  U_\mathrm{pol}^\mathrm{ref}
  +  \frac{1}{2}\sigma\PCM\sigma
  + \sigma\tilde{\esp}(\tamp{},\tbar{})
  + \frac{1}{2}\kappa\MM\kappa
  + \kappa\tilde{\zeta}(\tamp{},\tbar{})
  + \sigma\bi{X}\kappa \\
&+ \sigma^\mathrm{HF}\tilde{\esp}(\tamp{},\tbar{}) + \kappa^\mathrm{HF}\tilde{\zeta}(\tamp{},\tbar{})
  \end{aligned}
\end{equation}
Notice that the reference reaction energy still appears among the terms
in the functional. Obviously, these terms will not enter in the optimization of
the \acs{CC} wave function.
Introducing the supermatrix formalism, further simplifies the
polarization functional:
\begin{equation}
  \begin{aligned}
  U_\mathrm{pol} &=
    \frac{1}{2}\sigma\PCM\sigma
    + \sigma\tilde{\esp}(\tamp{},\tbar{})
  + \frac{1}{2}\kappa\MM\kappa
  + \kappa\tilde{\zeta}(\tamp{},\tbar{})
  + \sigma\bi{X}\kappa
  + \sigma^\mathrm{HF}\tilde{\esp}(\tamp{},\tbar{}) +
  \kappa^\mathrm{HF}\tilde{\zeta}(\tamp{},\tbar{})
  + U_\mathrm{pol}^\mathrm{ref}
  \\
  &=
  \frac{1}{2}\p^\dagger\V\p + \p^\dagger\tilde{\s}(\tamp{},\tbar{})
  + \p^{\mathrm{HF}, \dagger}\tilde{\s}(\tamp{},\tbar{})
  + U_\mathrm{pol}^\mathrm{ref}
\end{aligned}
\end{equation}

One can then write the effective Lagrangian as:
\begin{equation}
  \begin{aligned}
  \lag{M}(\tamp{}, \tbar{}, \p) &=
  \braket{\mathrm{HF} | \overline{H_0} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tamp{i} | \overline{H_0} | \mathrm{HF}} \\
  &+
  \frac{1}{2}\p^\dagger\V\p + \p^\dagger\tilde{\s}(\tamp{},\tbar{})
  + \p^{\mathrm{HF}, \dagger}\tilde{\s}(\tamp{},\tbar{})
  + U_\mathrm{pol}^\mathrm{ref}
  \end{aligned}
\end{equation}
In accordance with previous work,\autocite{Cammi2009-gu, Caricato2011-tx} the
Hamiltonian $H_0$ is augmented with the
$\p^{\mathrm{HF},\dagger}\tilde{\s}(\tamp{},\tbar{})$ term
to yield the \acl{PTE} (\acs{PTE}) Hamiltonian -- $H$ -- and the
eventually the \acl{PTED} (\acs{PTED}) Lagrangian:
\begin{equation}\label{eq:pted-cc}
  \lag{M}(\tamp{}, \tbar{}, \p) =
  {}^\mathrm{PTE}\lag{M}
  + \frac{1}{2}\p^\dagger\V\p + \p^\dagger\tilde{\s}(\tamp{},\tbar{})
\end{equation}
where the \acs{PTE} Lagrangian has been introduced:
\begin{equation}
{}^\mathrm{PTE}\lag{M}
  =
  \braket{\mathrm{HF} | \overline{H} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{H} | \mathrm{HF}}
  + U_\mathrm{pol}^\mathrm{ref}
\end{equation}

As noted by \citeauthor{Cammi2009-gu} for the implicit \acs{PCM} model,
the \acs{PTE} Hamiltonian is computed in \acs{MP}-partitioned form by
employing the ``solvated'' orbitals and Fock matrix:
\begin{equation}
  H = F + \Phi.
\end{equation}
$F$ is a diagonal one-electron operator and $\Phi$ is the
fluctuation potential.
The simple nature of the Fock operator lets us re-express the \acs{PTE}
Lagrangian as follows:
\begin{equation}
{}^\mathrm{PTE}\lag{M}
  =
  G_0
  + \sum_{i=1}^{\mathcal{M}}\tbar{\mu_i}\denom{\mu_i}\tamp{\mu_i}
  + \braket{\mathrm{HF} | \overline{\Phi} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{\Phi} | \mathrm{HF}}
\end{equation}
where $G_0 = E_0 + U_\mathrm{pol}^\mathrm{ref}$ is the reference free
energy.

Use of the \acs{PTE} Lagrangian yields \acs{CC} equations that are
completely equivalent in form to those obtained \emph{in vacuo}.
The model is also easily implemented, as it only requires access to a
reference state optimized in the presence of the classical medium.
The \acs{PTE} model thus offers an efficient approximation to the full
\acs{PTED} model with a computational cost comparable to that of
\emph{in vacuo} \acs{CC} theory.
As shown by \citeauthor{Caricato2011-tx}, it is possible to achieve less
drastic approximations of the \acs{PTED} Lagrangian. Such approximations
can be easily derived within the current variational framework. We
postpone this analysis to a later stage of development, \emph{vide
infra}.

\section{Source terms in the classical energy functional}

The variational formulation offers a series of advantages.
The classical energy functional:
\begin{equation}
  U_\mathrm{pol} =
   \frac{1}{2}\sigma\PCM\sigma + \sigma\esp
 + \frac{1}{2}\kappa\MM\kappa + \kappa\zeta
 + \sigma\bi{X}\kappa
\end{equation}
renders itself to a straightforward physical interpretation. In the
three bilinear terms, \ie{} the ones mediated by an interaction
operator, we can identify the self-interaction of the classical
polarization with itself, be it purely implicit:
$\frac{1}{2}\sigma\PCM\sigma$, purely explicit
$\frac{1}{2}\kappa\MM\kappa$ or mixed $\sigma\MMPCM\kappa$.
These terms are positive definite and give rise to an unfavorable
contribution, which is counterbalanced by the linear terms. These terms
mediate the interaction between the induced polarization and the
inducing fields: $\esp$ and $\zeta$. While $\esp$ is quite clearly the
\acl{MEP} (\acs{MEP}), $\zeta$ can either be the molecular electric
field (MMpol and PE models) or again the \acs{MEP} (FQ model).
In any case, both will be determined by the quantum mechanical molecular
charge density and can thus be formulated as expectation values of
one-electron operators. Eventually, this achieves the coupling between
the classical -- $\sigma$ and $\kappa$ -- and
the quantum mechanical variational degrees of freedom.

The \acs{MEP} operator is given as:
\begin{equation}
  \esp = \sum_{PQ}\esp_{PQ}\cons{P}\anni{Q}
\end{equation}
and similarly for the \acs{MM} source operator:
\begin{equation}
  \zeta = \sum_{PQ}\zeta_{PQ}\cons{P}\anni{Q}
\end{equation}
both are nondiagonal in the MO basis. However,
by virtue of the \emph{cluster commutation condition}, their similarity
transformations will truncate after two
terms:\autocite{Helgaker2000-tz}
\begin{equation}
  \overline{\esp} = \esp + \tilde{\esp}  = \esp + \commutator{\esp}{T} +
  \frac{1}{2}\commutator{\commutator{\esp}{T}}{T}
\end{equation}
and
\begin{equation}
  \overline{\zeta} = \zeta + \tilde{\zeta}  = \zeta + \commutator{\zeta}{T} +
  \frac{1}{2}\commutator{\commutator{\zeta}{T}}{T}
\end{equation}

In the supermatrix formalism, the similarity-transformed terms will be
written as:
\begin{equation}
  \overline{\s} = \s + \tilde{\s} = \s +
  \commutator{\s}{T} +
  \frac{1}{2}\commutator{\commutator{\s}{T}}{T}
\end{equation}
It is important to single out which terms contribute in the various
expectation values where the similarity-transformed sources will be
involved.
We develop this analysis in terms of excitation ranks of the
operators involved, based on the following:
\begin{equation}
  \braket{\mu_n |
  \commutator{\commutator{\commutator{O}{T_{n_1}}}{\ldots}}{T_{n_k}} | \mathrm{HF}} \neq 0
  \Longleftrightarrow
  n - m_O + k \leq \sum_{i=1}^k n_i \leq n + m_O
\end{equation}
where $n$ is the excitation rank of the $\ket{\mu_n}$ determinant, $k$
is the total number of cluster operators appearing in the nested
commutator, the $n_i$ are their respective excitations ranks and $m_O$
is the \emph{particle rank} of the operator $O$.\autocite{Helgaker2000-tz}
This follows from the realization that:
\begin{equation}
  \commutator{\commutator{\commutator{O}{T_{n_1}}}{\ldots}}{T_{n_k}} \ket{\mathrm{HF}}
\end{equation}
is a linear combination of determinants with excitation ranks $v$ in the
range:
\begin{equation}
  \sum_{i=1}^k n_i - m_O \leq v \leq \sum_{i=1}^k n_i + m_O -k
\end{equation}

We first expand the source terms entering the Lagrangian as follows:
\begin{equation}
  \tilde{\s}(\tamp{}, \tbar{}) =
  \braket{\mathrm{HF} | \BCHfirst{\s}{T} + \BCHsecond{\s}{T} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \s + \BCHfirst{\s}{T} +
  \BCHsecond{\esp}{T} | \mathrm{HF}},
\end{equation}
and since $\s$ has particle rank $m_\s = 1$ we can conclude that the
following relationships hold:
\begin{subequations}
\begin{align}
  \braket{\mathrm{HF} |
  \BCHfirst{\s}{T_t}
  | \mathrm{HF}}
  &\quad\quad\text{nonzero contributions} \quad 0 \leq t \leq 1
  \Longleftrightarrow t = 1 \\
  \braket{\mathrm{HF} |
  \commutator{\commutator{\s}{T_t}}{T_u}
  | \mathrm{HF}}
  &\quad\quad\text{nonzero contributions} \quad t + u = 1 \\
  \braket{\tbar{i} |
  \s
  | \mathrm{HF} }
  &\quad\quad\text{nonzero contributions} \quad i = 1 \\
  \braket{\tbar{i} |
  \BCHfirst{\s}{T_t}
  | \mathrm{HF} }
  &\quad\quad\text{nonzero contributions} \quad i \leq t \leq i + 1 \\
  \braket{\tbar{i} |
  \commutator{\commutator{\s}{T_t}}{T_u}
  | \mathrm{HF} }
  &\quad\quad\text{nonzero contributions} \quad t + u = i + 1
\end{align}
\end{subequations}
For a general truncation level we accordingly obtain:
\begin{equation}\label{eq:source-term}
  \tilde{\s}(\tamp{}, \tbar{}) =
  \braket{\mathrm{HF} | \BCHfirst{\s}{T_1} | \mathrm{HF}}
  + \braket{\tbar{1} | \s | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \BCHfirst{\s}{T} + \BCHsecond{\s}{T} | \mathrm{HF}}
\end{equation}
Furthermore, for the \acs{CCS} model ($\mathcal{M} = 1$):
\begin{equation}
  \tilde{\s}^1(\tamp{}, \tbar{}) =
  \braket{\mathrm{HF} | \BCHfirst{\s}{T_1} | \mathrm{HF}}
  + \braket{\tbar{1} | \s | \mathrm{HF}}
  + \braket{\tbar{1} | \BCHfirst{\s}{T_1} | \mathrm{HF}}
  + \frac{1}{2}\braket{\tbar{1} | \commutator{\commutator{\s}{T_1}}{T_1} | \mathrm{HF}}
\end{equation}
while for the \acs{CCSD} model ($\mathcal{M} = 2$):
\begin{equation}
  \tilde{\s}^2(\tamp{}, \tbar{}) =
  \tilde{\s}^1(\tamp{}, \tbar{})
  + \braket{\tbar{1} | \BCHfirst{\s}{T_2} | \mathrm{HF}}
  + \braket{\tbar{2} | \BCHfirst{\s}{T_2} | \mathrm{HF}}
  + \braket{\tbar{2} | \commutator{\commutator{\s}{T_1}}{T_2} | \mathrm{HF}}
\end{equation}
Eventually, within the \acs{CCSDT} model ($\mathcal{M} = 3$) four more
terms are added:
\begin{equation}
  \begin{aligned}
  \tilde{\s}^3(\tamp{}, \tbar{}) &=
  \tilde{\s}^2(\tamp{}, \tbar{})
  + \braket{\tbar{2} | \BCHfirst{\s}{T_3} | \mathrm{HF}} \\
  &+ \braket{\tbar{3} | \BCHfirst{\s}{T_3} | \mathrm{HF}}
  + \frac{1}{2}
  \braket{\tbar{3} | \commutator{\commutator{\s}{T_2}}{T_2} |
  \mathrm{HF}}
  + \braket{\tbar{3} | \commutator{\commutator{\s}{T_1}}{T_3} |
  \mathrm{HF}}
  \end{aligned}
\end{equation}
We note that:
\begin{itemize}
  \item singles amplitudes assume a unique role when a quantum/classical
    Hamiltonian is introduced, a role that will be more evident in the
    perturbative treatment,
  \item double commutators involving the highest order cluster
    operators can only lead to nonzero terms when $T_1$ is also
    involved and by projection onto the highest order left \acs{CC}
    state, \emph{e.g.}
    $\braket{\tbar{2} | \commutator{\commutator{\s}{T_1}}{T_2} |
    \mathrm{HF}} \neq 0$
    and
    $\braket{\tbar{3} | \commutator{\commutator{\s}{T_1}}{T_3} |
    \mathrm{HF}} \neq 0$
\end{itemize}

\section{A family of PCM-CC models}\label{sec:pcm-cc-models}

Differentiation of the effective Lagrangian in Eq.~\eqref{eq:pted-cc}
with respect to the variational parameters $\tamp{\mu_i}$,
$\tbar{\mu_i}$ and $\p$ yields the \acs{PTED}-\acs{CC}
equations:
\begin{subequations}
  \begin{align}
   \tampEq{\mu_i}(\tamp{}, \tbar{}, \p)  &=
   \denom{\mu_i}\tamp{\mu_i} + \braket{\mu_i | \overline{\Phi} | \mathrm{HF}}
   + \p^\dagger\braket{\mu_i | \overline{\s} | \mathrm{HF}}
             = 0 \label{eq:pted-cc-amplitudes}\\
   \tbarEq{\mu_i}(\tamp{}, \tbar{}, \p)
    &=
    \denom{\mu_i}\tbar{\mu_i} +
    \braket{\mathrm{HF} | \commutator{\overline{\Phi}}{\cluster{\mu_i}} | \mathrm{HF}} +
    \sum_{j}^{\mathcal{M}}\braket{\tbar{j} |
    \commutator{\overline{\Phi}}{\cluster{\mu_i}} | \mathrm{HF}}
    \nonumber \\
    &+ \p^\dagger\lbrace
    \braket{\mathrm{HF} | \commutator{\s}{\cluster{\mu_i}} +
    \commutator{\commutator{\s}{T}}{\cluster{\mu_i}}| \mathrm{HF}} +
    \sum_{j}^{\mathcal{M}}\braket{\tbar{j} | \commutator{\overline{\s}}{\cluster{\mu_i}} | \mathrm{HF}}
             \rbrace
             = 0 \label{eq:pted-cc-multipliers}\\
    \Omega_\p(\tamp{}, \tbar{}, \p)
    &=
    \V\p + \tilde{\s}(\tamp{}, \tbar{}) = 0
    \label{eq:pted-cc-polarization}
  \end{align}
\end{subequations}
These equations clearly show:
\begin{enumerate}
  \item The $\tilde{\s}(\tamp{}, \tbar{})$ expectation value term in the
    polarization equation couples the amplitudes, multipliers and
    polarization equations.
    This requires a proper macroiteration/microiteration
    self-consistency scheme for its implementation.~\autocite{Cammi2009-gu, Caricato2010-hx}
  \item As a consequence, a single-point \acs{PTED}-\acs{CC} will
    suffer from a $2\times$ prefactor in its computational cost with
    respect to an \emph{in vacuo} \acs{CC} calculation.
  \item Eq.~\eqref{eq:pted-cc-polarization} is \emph{directly} coupled to
    the multipliers equation, Eq.~\eqref{eq:pted-cc-multipliers}, since
    the source terms directly depends on amplitudes and multipliers, but
    only \emph{indirectly} coupled to the amplitudes equation,
    Eq.~\eqref{eq:pted-cc-amplitudes}.
\end{enumerate}

One might exploit point 3 above to reduce the prefactor of the method to
that of an \emph{in vacuo} \acs{CC} calculation.
The simplest approach is to neglect altogether the polarization equation
and the polarization degree of freedom. This is equivalent to
differentiating the polarization-independent \acs{PTE} effective
Lagrangian:
\begin{subequations}
  \begin{align}
   \tampEq{\mu_i}(\tamp{}, \tbar{}, \p)  &=
   \denom{\mu_i}\tamp{\mu_i} + \braket{\mu_i | \overline{\Phi} | \mathrm{HF}}
    = 0 \\
   \tbarEq{\mu_i}(\tamp{}, \tbar{}, \p)
    &=
    \denom{\mu_i}\tbar{\mu_i} +
    \braket{\mathrm{HF} | \commutator{\overline{\Phi}}{\cluster{\mu_i}} | \mathrm{HF}} +
    \sum_{j}^{\mathcal{M}}\braket{\tbar{j} |
    \commutator{\overline{\Phi}}{\cluster{\mu_i}} | \mathrm{HF}}
    = 0
  \end{align}
\end{subequations}
The \acs{PTE} scheme naturally preserves the scaling of the underlying \acs{CC}
method.
The \acs{PTE} scheme is advantageous since no coupling between the
\acs{CC} amplitude and multiplier equations is introduced. However, the
polarization included in the correlation treatment is the same as for
the reference determinant, an approximation which appears questionable
from the point of view of classical electrostatics.
There is, in fact, no relaxation of the reference reaction
field due to the correlated description of the electronic density.

The leading terms in the correlated source operator expectation
value, Eq.~\eqref{eq:source-term}, prominently involve the singles
cluster operator and the singles left \acs{CC} state.
This simple fact led \citeauthor{Caricato2011-tx} to propose two
intermediate approximations in between the \acs{PTE} and \acs{PTED}
schemes: the \acs{PTES} and \acs{PTE(S)} schemes.
If we truncate the correlated source operator expectation value
to the first term in Eq.~\eqref{eq:source-term}, the coupling between
the \acs{CC} right and left states is broken, while still improving upon the
reference reaction field with correlated contributions.
This is the essence of the \acs{PTE(S)} approximation. The effective
Lagrangian would then read as:
\begin{equation}\label{eq:ptes-cc}
  ^{\mathrm{PTE(S)}}\lag{M}(\tamp{}, \tbar{}, \p) =
  \braket{\mathrm{HF} | \overline{H} | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i} | \overline{H} | \mathrm{HF}}
  + \frac{1}{2}\p^\dagger\V\p + \p^\dagger
  \braket{\mathrm{HF} | \BCHfirst{\s}{T_1} | \mathrm{HF}}
\end{equation}
which uncouples all equations:
\begin{subequations}
  \begin{align}
   &\denom{\mu_i}\tamp{\mu_i} + \braket{\mu_i | \overline{\Phi} | \mathrm{HF}}
   = 0 \\
    &\denom{\mu_1}\tbar{\mu_1} +
    \braket{\mathrm{HF} | \commutator{\overline{\Phi}}{\cluster{\mu_1}} | \mathrm{HF}} +
    \sum_{j}^{\mathcal{M}}\braket{\tbar{j} |
    \commutator{\overline{\Phi}}{\cluster{\mu_1}} | \mathrm{HF}}
    + \p^\dagger
    \braket{\mathrm{HF} | \commutator{\s}{\cluster{\mu_1}} | \mathrm{HF}}
    = 0 \\
    &\denom{\mu_i}\tbar{\mu_i} +
    \braket{\mathrm{HF} | \commutator{\overline{\Phi}}{\cluster{\mu_i}} | \mathrm{HF}} +
    \sum_{j}^{\mathcal{M}}\braket{\tbar{j} |
    \commutator{\overline{\Phi}}{\cluster{\mu_i}} | \mathrm{HF}}
    = 0  \quad \forall i \neq 1 \\
    &\V\p + \braket{\mathrm{HF} | \BCHfirst{\s}{T_1} | \mathrm{HF}} = 0
  \end{align}
\end{subequations}
The amplitude equations are formally equivalent to those derived in the
\acs{PTE} scheme. The equations for multipliers are also formally
equivalent to the \acs{PTE} equations, apart from the equation
determining the singles multipliers which is augmented by an additional term:
$\p^\dagger\braket{\mathrm{HF} | \commutator{\s}{\cluster{\mu_1}} |
\mathrm{HF}}$
This term is not, however, coupled to the other equations given that
$\p$ is fixed once the singles amplitudes have been determined.
Practical implementation of the \acs{PTE(S)} scheme will solve the
\acs{PTE}-like amplitude equation, form the source term
$\braket{\mathrm{HF} | \BCHfirst{\s}{T_1} | \mathrm{HF}}$, solve for
the polarization degrees of freedom and calculate the polarization
energy as a correction to the \acs{CC} energy.
Only when a first-order molecular property, such as the molecular
gradient, is needed, will the multipliers equations need to be solved.
In other words, only the $T_1$-dependent part of the \acs{CC} density is
used to define the classical sources.

\todo[inline]{Can't really figure out how the \acs{PTES} scheme can be
devised in this framework. The idea seems to be to preserve the form of
the \acs{PTED} equations, but dropping the dependence on the Lagrange
multipliers. This can be achieved by decoupling the \acs{PCM} equation
from the multipliers equation, \ie{} by using only the part of the
density matrix that depends on the $T_1$ amplitudes to define the source
term. This seems to miss, however, part of the terms in the \acs{PTES}
multipliers equations, that are, in Caricato's treatment, still
coupled with the \acs{PCM} equation.}

\section[Coupled Cluster Perturbation Theory]{
Coupled Cluster Perturbation Theory for a Quantum/Classical Polarizable Hamiltonian}\label{sec:ccpt-polarizable}

We will now develop a perturbative expansion of the effective \acs{CC}
Lagrangian and derive the \acs{CC}\acs{PT} series when a
quantum/classical polarizable Hamiltonian is used.
The fluctuation potential $\Phi$ is assumed as the perturbation, hence
it will be considered of order 1: $\Phi = O(1)$.
Orders will be counted assuming closed-shell \acs{HF} reference:
we will use square brackets $[i]$ for an $i$-th order contributions.

The structure of the stationarity conditions
Eqs.~\eqref{eq:pted-cc-amplitudes} and \eqref{eq:pted-cc-multipliers},
already shows that $\tamp{\mu_i}^{[0]} = 0, \quad \forall i$ and
$\tbar{\mu_i}^{[0]} = 0, \quad \forall i$.

The \acs{PTED}-\acs{CC} equations are expanded in orders of the
perturbation and terms are collected order by order. The use of an
effective, variational Lagrangian implies the validity of the $2n+1$
rule for the amplitudes $\tamp{\mu_i}$ and polarization $\p$ and of the
$2n+2$ rule for the multipliers $\tbar{\mu_i}$.
We can thus derive energy corrections up to fifth order by means of the
amplitudes and polarization up to and including second order terms and
the multipliers up to and including second order.

The polarization equation couples to the multipliers and amplitudes
equations \emph{via} the source term, see Eq.~\eqref{eq:source-term}.
Its perturbative expansion will be given as:
\begin{equation}\label{eq:source-term-pt}
  \tilde{\s}(\tamp{},\tbar{}) =
  \tilde{\s}^{[0]}
  + \tilde{\s}^{[1]}
  + \tilde{\s}^{[2]}
  + \ldots
\end{equation}
and correspondingly for the polarization:
\begin{equation}\label{eq:pol-eq-pt}
  \V\p^{[i]} + \tilde{\s}^{[i]} = 0
\end{equation}

The source operator $\s$ will be considered as \emph{zeroth-order} in
the perturbation.
The order of the contributions to $\tilde{\s}(\tamp{},\tbar{})$ will be
solely determined by the amplitudes and multipliers.
From the structure of \eqref{eq:pted-cc-polarization}, it is already
clear that $\tilde{\s}(\tamp{},\tbar{})$ is at least first order in the
fluctuation potential:
\begin{equation}
  \tilde{\s}(\tamp{},\tbar{}) =
  \tilde{\s}^{[1]}
  + \tilde{\s}^{[2]}
  + \ldots
\end{equation}
which also implies:
\begin{equation}
  \V\p^{[0]} + \tilde{\s}^{[0]} = 0 \Rightarrow  \p^{[0]} = 0
\end{equation}

\paragraph*{Perturbative expansion of $\tilde{\s}$}

\begin{equation}\label{eq:source-1st-order}
  \tilde{\s}^{[1]}(\tamp{}, \tbar{}) =
  \braket{\mathrm{HF} | \BCHfirst{\s}{T^{[1]}_1} | \mathrm{HF}}
  + \braket{\tbar{1}^{[1]} | \s | \mathrm{HF}}
\end{equation}
In the free energy corrections we will use the $2n+1$ and $2n+2$ complying
expression:
\begin{equation}\label{eq:source-1st-order-rules}
  \tilde{\s}^{[1]}(\tamp{}, \tbar{}) =
  \braket{\mathrm{HF} | \BCHfirst{\s}{T^{[1]}_1} | \mathrm{HF}}
\end{equation}

\begin{equation}\label{eq:source-2nd-order}
  \tilde{\s}^{[1]}(\tamp{}, \tbar{}) =
  \braket{\mathrm{HF} | \BCHfirst{\s}{T^{[2]}_1} | \mathrm{HF}}
  + \braket{\tbar{1}^{[2]} | \s | \mathrm{HF}}
  + \sum_{i=1}^{\mathcal{M}}\braket{\tbar{i}^{[1]} | \BCHfirst{\s}{T^{[1]}} | \mathrm{HF}}
\end{equation}
In the free energy corrections we will use the $2n+1$ and $2n+2$ complying
expression:
\begin{equation}\label{eq:source-2nd-order-rules}
  \tilde{\s}^{[2]}(\tamp{}, \tbar{}) =
  \braket{\mathrm{HF} | \BCHfirst{\s}{T^{[2]}_1} | \mathrm{HF}}
  + \braket{\tbar{i}^{[1]} | \BCHfirst{\s}{T^{[1]}} | \mathrm{HF}}
\end{equation}



\subsection{First order equations}\label{sec:first-order-pt}

\paragraph*{Amplitudes}
\begin{equation}
  \Omega_{\mu_i}^{[1]} = \denom{\mu_i}\tamp{\mu_i}^{[1]}
  + \braket{\mu_i | \Phi | \mathrm{HF}}
  + \p^{\dagger\,[1]}\braket{\mu_i | \bar{\s}^{[0]} | \mathrm{HF}}
  + \p^{\dagger\,[0]}\braket{\mu_i | \bar{\s}^{[1]}  | \mathrm{HF}}
  = 0
\end{equation}
And since $\p^{[0]} = 0$ and $\bar{\s}^{[0]} = \s$:
\begin{equation}\label{eq:1st-order-amp}
  \Omega_{\mu_i}^{[1]} = \denom{\mu_i}\tamp{\mu_i}^{[1]}
  + \braket{\mu_i | \Phi | \mathrm{HF}}
  + \p^{\dagger\,[1]}\braket{\mu_i | \s | \mathrm{HF}}
  = 0
\end{equation}
Considering the singles and doubles excitation manifolds:
\begin{subequations}
  \begin{align}
  \Omega_{\mu_1}^{[1]} &= \denom{\mu_1}\tamp{\mu_1}^{[1]}
  + \p^{\dagger\,[1]}\braket{\mu_1 | \s | \mathrm{HF}}
  = 0 \\
  \Omega_{\mu_2}^{[1]} &= \denom{\mu_2}\tamp{\mu_2}^{[1]}
  + \braket{\mu_2 | \Phi | \mathrm{HF}}
  = 0
  \end{align}
\end{subequations}
Thus, despite the closed-shell \acs{HF} reference, the singles
amplitudes will already appear in first order, due to the
quantum/classical coupling.

\paragraph*{Multipliers}
  \begin{equation}\label{eq:1st-order-mult}
    \bar{\Omega}_{\mu_i}^{[1]} =
      \denom{\mu_i}\tbar{\mu_i}^{[1]}
      + \braket{\mathrm{HF} | \commutator{\Phi}{\cluster{\mu_i}} | \mathrm{HF}}
      + \p^{\dagger\,[1]}\braket{\mathrm{HF} |
      \commutator{\s}{\cluster{\mu_i}} | \mathrm{HF}} =0
  \end{equation}
Considering the singles and doubles excitation manifolds:
\begin{subequations}
  \begin{align}
    \bar{\Omega}_{\mu_1}^{[1]} &= \denom{\mu_1}\tbar{\mu_1}^{[1]}
      + \p^{\dagger\,[1]}\braket{\mathrm{HF} |
      \commutator{\s}{\cluster{\mu_1}} | \mathrm{HF}}
  = 0 \\
    \bar{\Omega}_{\mu_2}^{[1]} &= \denom{\mu_2}\tbar{\mu_2}^{[1]}
      + \braket{\mathrm{HF} | \commutator{\Phi}{\cluster{\mu_2}} | \mathrm{HF}}
  = 0
  \end{align}
\end{subequations}
Thus, despite the closed-shell \acs{HF} reference, the singles
multipliers will already appear in first order, due to the
quantum/classical coupling.
\paragraph*{Polarization}
  \begin{equation}\label{eq:1st-order-pol}
    \V\p^{[1]} + \braket{\mathrm{HF} | \commutator{\s}{T_1^{[1]}}| \mathrm{HF}}
    + \braket{\tbar{1}^{[1]} | \s | \mathrm{HF} } = 0
  \end{equation}

\subsection{Second order equations}\label{sec:second-order-pt}

\paragraph*{Amplitudes}
\begin{equation}\label{eq:2nd-order-amp}
  \Omega_{\mu_i}^{[2]} = \denom{\mu_i}\tamp{\mu_i}^{[2]}
  + \braket{\mu_i | \commutator{\Phi}{T^{[1]}} | \mathrm{HF}}
  + \p^{\dagger\,[2]}\braket{\mu_i | \s | \mathrm{HF}}
  + \p^{\dagger\,[1]}\braket{\mu_i | \commutator{\s}{T^{[1]}} |
  \mathrm{HF}}
  = 0
\end{equation}
Considering the singles, doubles and triples excitation manifolds:
\begin{subequations}
  \begin{align}
  \Omega_{\mu_1}^{[2]} &= \denom{\mu_1}\tamp{\mu_1}^{[2]}
  + \braket{\mu_1 | \commutator{\Phi}{T^{[1]}} | \mathrm{HF}}
  + \p^{\dagger\,[2]}\braket{\mu_1 | \s | \mathrm{HF}}
  + \p^{\dagger\,[1]}\braket{\mu_1 | \commutator{\s}{T^{[1]}} |
  \mathrm{HF}}
  = 0 \\
  \Omega_{\mu_2}^{[2]} &= \denom{\mu_2}\tamp{\mu_2}^{[2]}
  + \braket{\mu_2 | \commutator{\Phi}{T^{[1]}} | \mathrm{HF}}
  + \p^{\dagger\,[1]}\braket{\mu_2 | \commutator{\s}{T_2^{[1]}} |
  \mathrm{HF}}
  = 0 \\
  \Omega_{\mu_3}^{[2]} &= \denom{\mu_3}\tamp{\mu_3}^{[2]}
  + \braket{\mu_3 | \commutator{\Phi}{T^{[1]}} | \mathrm{HF}}
  = 0
  \end{align}
\end{subequations}
The triples first appear to second order and are not \emph{directly}
affected by the quantum/classical coupling.
\paragraph*{Multipliers}
  \begin{equation}\label{eq:2nd-order-mult}
    \begin{aligned}
    \bar{\Omega}_{\mu_i}^{[2]} &=
      \denom{\mu_i}\tbar{\mu_i}^{[2]}
      + \braket{\mathrm{HF} | \commutator{\commutator{\Phi}{T^{[1]}}}{\cluster{\mu_i}} | \mathrm{HF}}
      + \sum_j\braket{\tbar{j}^{[1]} |
      \commutator{\Phi}{\cluster{\mu_i}} | \mathrm{HF}} \\
      &+ \p^{\dagger\,[2]}\braket{\mathrm{HF} |
      \commutator{\s}{\cluster{\mu_i}} | \mathrm{HF}}
      + \p^{\dagger\,[1]}
      \sum_j\braket{\tbar{j}^{[1]} |
      \commutator{\s}{\cluster{\mu_i}} | \mathrm{HF}}
      =0
    \end{aligned}
  \end{equation}
Considering the singles, doubles and triples excitation manifolds:
\begin{subequations}
  \begin{align}
    \bar{\Omega}_{\mu_1}^{[2]} &=
      \denom{\mu_1}\tbar{\mu_1}^{[2]}
      + \braket{\mathrm{HF} | \commutator{\commutator{\Phi}{T^{[1]}}}{\cluster{\mu_1}} | \mathrm{HF}}
      + \sum_j\braket{\tbar{j}^{[1]} |
      \commutator{\Phi}{\cluster{\mu_1}} | \mathrm{HF}} \\
      &+ \p^{\dagger\,[2]}\braket{\mathrm{HF} |
      \commutator{\s}{\cluster{\mu_1}} | \mathrm{HF}}
      + \p^{\dagger\,[1]}
      \braket{\tbar{1}^{[1]} |
      \commutator{\s}{\cluster{\mu_1}} | \mathrm{HF}}
      =0 \\
    \bar{\Omega}_{\mu_2}^{[2]} &=
      \denom{\mu_2}\tbar{\mu_2}^{[2]}
      + \braket{\mathrm{HF} | \commutator{\commutator{\Phi}{T^{[1]}}}{\cluster{\mu_2}} | \mathrm{HF}}
      + \sum_j\braket{\tbar{j}^{[1]} |
      \commutator{\Phi}{\cluster{\mu_2}} | \mathrm{HF}} \\
      &+ \p^{\dagger\,[1]}
      \braket{\tbar{1}^{[1]} + \tbar{2}^{[1]} |
      \commutator{\s}{\cluster{\mu_2}} | \mathrm{HF}}
      =0 \\
    \bar{\Omega}_{\mu_3}^{[2]} &=
      \denom{\mu_3}\tbar{\mu_3}^{[2]}
      + \braket{\mathrm{HF} | \commutator{\commutator{\Phi}{T^{[1]}}}{\cluster{\mu_3}} | \mathrm{HF}}
      + \sum_j\braket{\tbar{j}^{[1]} |
      \commutator{\Phi}{\cluster{\mu_3}} | \mathrm{HF}}
      =0
  \end{align}
\end{subequations}
The triples first appear to second order and are not \emph{directly}
affected by the quantum/classical coupling.

\paragraph*{Polarization}
  \begin{equation}\label{eq:2nd-order-pol}
    \begin{aligned}
    \V\p^{[2]} &+
    \braket{\mathrm{HF} | \commutator{\s}{T_1^{[2]}}| \mathrm{HF}}
    + \braket{\tbar{1}^{[2]} | \s | \mathrm{HF} }
    + \braket{\tbar{1}^{[1]} | \commutator{\s}{T_1^{[1]}} | \mathrm{HF}}
    \\
    &+
    \braket{\tbar{2}^{[1]} | \commutator{\s}{T_2^{[1]}} | \mathrm{HF}}
    = 0
  \end{aligned}
  \end{equation}
No triples contributions enter directly up to second order.

\subsection{Free energies up to fifth order}\label{sec:energies-pt}

From the expansion of the effective Lagrangian we can obtain free energy
corrections up to the desired order. Given the variational nature of the
Lagrangian, only terms fulfilling the $2n+1$ and $2n+2$ rules will
appear in the free energy corrections.
To zeroth-order all variational parameters are zero. To first order we
thus have:
\begin{equation}\label{eq:first-order-G}
  G^{[1]} = \braket{\mathrm{HF} | \Phi | \mathrm{HF}}
\end{equation}
The reference energy can thus be recovered as usual:
\begin{equation}
  G_\mathrm{HF} = G^{[0]} + G^{[1]}
\end{equation}
where $G^{[0]}$ includes the quantum/classical coupling.
\todo[inline]{Check this statement, the Lagrangian has a zeroth-order
term!}

\begin{equation}\label{eq:second-order-G}
  \begin{aligned}
  G^{[2]} &= \braket{\mathrm{HF} | \commutator{\Phi}{T^{[1]}} | \mathrm{HF}}
  + \frac{1}{2}\p^{\dagger\,[1]}\V\p^{[1]} +
  \p^{\dagger\,[1]}\tilde{\s}^{[1]} \\
  &= E^{[2]} + \frac{1}{2}\p^{\dagger\,[1]}\V\p^{[1]} +
  \p^{\dagger\,[1]}
  \braket{\mathrm{HF} | \commutator{\s}{T^{[1]}_1} | \mathrm{HF}}
  \end{aligned}
\end{equation}
Notice that the source term is here assembled in accordance to the $2n+1$
and $2n+2$ rules, while this is not the case in the equations for the
polarization.

\begin{equation}\label{eq:third-order-G}
  \begin{aligned}
    G^{[3]} &= \sum_j\braket{\tbar{j}^{[1]} | \commutator{\Phi}{T^{[1]}} |
    \mathrm{HF}} + \p^{\dagger\, [1]}\tilde{\s}^{[2]} \\
    &= E^{[3]}
    + \p^{\dagger\, [1]}
    \lbrace
      \braket{\tbar{1}^{[1]} | \commutator{\s}{T^{[1]}_1} | \mathrm{HF}}
    + \braket{\tbar{1}^{[1]} | \commutator{\s}{T^{[1]}_2} | \mathrm{HF}}
    + \braket{\tbar{2}^{[1]} | \commutator{\s}{T^{[1]}_2} | \mathrm{HF}}
    \rbrace
  \end{aligned}
\end{equation}

\begin{equation}\label{eq:fourth-order-G}
  \begin{aligned}
    G^{[4]} &= \sum_j\braket{\tbar{j}^{[1]} | \commutator{\Phi}{T^{[2]}} |
    \mathrm{HF}} +
    \frac{1}{2}\sum_j\braket{\tbar{j}^{[1]} |
    \commutator{\commutator{\Phi}{T^{[1]}}}{T^{[1]}} |
    \mathrm{HF}} \\
    &+\frac{1}{2}\p^{\dagger\,[2]}\V\p^{[2]}
    + \p^{\dagger\,[2]}\tilde{\s}^{[2]}
    + \p^{\dagger\,[1]}\tilde{\s}^{[3]} \\
    &= E^{[4]} + \frac{1}{2}\p^{\dagger\,[2]}\V\p^{[2]}
    +\p^{\dagger\,[2]}
    \lbrace
      \braket{\tbar{1}^{[1]} | \commutator{\s}{T^{[1]}_1} | \mathrm{HF}}
    + \braket{\tbar{1}^{[1]} | \commutator{\s}{T^{[1]}_2} | \mathrm{HF}}
    + \braket{\tbar{2}^{[1]} | \commutator{\s}{T^{[1]}_2} | \mathrm{HF}}
    \rbrace \\
    &+\p^{\dagger\,[1]}
    \lbrace
    \frac{1}{2}\braket{\tbar{1}^{[1]} |
    \commutator{\commutator{\s}{T^{[1]}_1}}{T^{[1]}_1}
    |
    \mathrm{HF}}
    + \braket{\tbar{2}^{[1]} |
    \commutator{\commutator{\s}{T^{[1]}_1}}{T^{[1]}_2}
    |
    \mathrm{HF}}
    \rbrace
  \end{aligned}
\end{equation}

\begin{equation}\label{eq:fifth-order-G}
  \begin{aligned}
    G^{[5]} &=
    \frac{1}{2}\braket{\mathrm{HF} |
    \commutator{\commutator{\Phi}{T^{[2]}}}{T^{[2]}}
    | \mathrm{HF}}
    +
    \sum_j \braket{\tbar{j}^{[1]} |
    \commutator{\commutator{\Phi}{T^{[2]}}}{T^{[1]}}
    | \mathrm{HF}} \\
    &+ \sum_j \braket{\tbar{j}^{[2]} |
      \commutator{\Phi}{T^{[2]}}
    | \mathrm{HF}}
    +
    \frac{1}{2}\sum_j\braket{\tbar{j}^{[2]} |
    \commutator{\commutator{\Phi}{T^{[1]}}}{T^{[1]}}
    | \mathrm{HF}}
    + \p^{\dagger\,[2]}\tilde{\s}^{[3]}
    + \p^{\dagger\,[1]}\tilde{\s}^{[4]} \\
    &= E^{[5]}
    + \p^{\dagger\,[2]}
    \lbrace
    \frac{1}{2}\braket{\tbar{1}^{[1]} |
    \commutator{\commutator{\s}{T_1^{[1]}}}{T_1^{[1]}}
    | \mathrm{HF}}
    + \braket{\tbar{2}^{[1]} |
    \commutator{\commutator{\s}{T_1^{[1]}}}{T_2^{[1]}}
    | \mathrm{HF}}
    \rbrace \\
    &+ \p^{\dagger\,[1]}
    \lbrace
    \braket{\tbar{1}^{[1]} |
    \commutator{\commutator{\s}{T_1^{[2]}}}{T_1^{[1]}}
    | \mathrm{HF}}
    + \braket{\tbar{2}^{[1]} |
    \commutator{\commutator{\s}{T_1^{[2]}}}{T_2^{[1]}}
    | \mathrm{HF}}
    + \braket{\tbar{2}^{[1]} |
    \commutator{\commutator{\s}{T_1^{[1]}}}{T_2^{[2]}}
    | \mathrm{HF}}
    \rbrace
  \end{aligned}
\end{equation}
