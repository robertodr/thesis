\chapter{Some Mathematical Results}\label{app:mathematical-results}

\begin{lemma}[Properties of the boundary integral operators]
  The integral operators introduced above enjoy the following
  properties~\autocite{Hsiao2008-xb, Sauter2011-an}:
  \begin{enumerate}
      \item on $L^2(\Gamma)$, $\bi{S}_\star$ is self-adjoint,
        $\bi{D}^\dagger_\star$ is the adjoint operator of
        $\bi{D}_\star$.
      \item The commutation relations hold:
        \begin{alignat}{2}
          \bi{D}_\star\bi{S}_\star = \bi{S}_\star\bi{D}^\dagger_\star, \quad&
          \bi{S}_\star\bi{D}_\star = \bi{D}^\dagger_\star\bi{S}_\star
        \end{alignat}
      \item The boundary integral operators are continuous
        mappings between Sobolev spaces of fractional order:
        \begin{subequations}
          \begin{align}
   \bi{S}_\star &: H^{-\frac{1}{2}}(\Gamma) \rightarrow H^{\frac{1}{2}}(\Gamma) \\
   \bi{D}_\star &: H^{\frac{1}{2}}(\Gamma) \rightarrow H^{\frac{1}{2}}(\Gamma) \\
   \bi{D}^\dagger_\star &: H^{-\frac{1}{2}}(\Gamma) \rightarrow H^{-\frac{1}{2}}(\Gamma)
          \end{align}
        \end{subequations}
      \item The operator $\bi{S}_\star$ is coervice and admits a
        continuous inverse in the aforementioned Sobolev spaces.
      \item The operators $\lambda - \bi{D}_\star$ and $\lambda -
        \bi{D}^\dagger_\star$ with $\lambda \in (-2\pi, +\infty)$
        admit a continuous inverse in the aforementioned
        Sobolev spaces.
  \end{enumerate}
\end{lemma}

\subsection{Lemma of Integral Representation}
For the transmission problem \ref{eq:transmission} there holds:
\begin{itemize}
\item $\forall x \in \Omegai$
\begin{equation}
u = \bi{S}_\mathrm{i}(\partiali u)
- \bi{D}_\mathrm{i}(\ui) + \int_{\Omegai} \Gi f_\mathrm{i}\diff y
\end{equation}
\item $\forall x \in \Omegae$
\begin{equation}
u = -\bi{S}_\mathrm{e}(\partiale u)
+ \bi{D}_\mathrm{e}(\ue) + \int_{\Omegae}\Ge f_\mathrm{e}\diff y
\end{equation}
\item $\forall x \in \Gamma$
  \begin{equation}\label{eq:stat3}
    \frac{1}{2}\ui = \bi{S}_\mathrm{i}(\partiali u)
    - \bi{D}_\mathrm{i}(\ui) + \int_{\Omegai}\Gi f_\mathrm{i}\diff y
  \end{equation}
\item $\forall x \in \Gamma$
  \begin{equation}\label{eq:stat4}
    \frac{1}{2}\ue = -\bi{S}_\mathrm{e}(\partiale u)
    + \bi{D}_\mathrm{e}(\ue) + \int_{\Omegae}\Ge f_\mathrm{e}\diff y
  \end{equation}
\end{itemize}

We introduce the following auxiliary potential:
\begin{equation}
  h(x) =
  \begin{cases}
    &\int_{\mathbb{R}^3}\Gi\rhoi(y)\diff y  \quad x \in \Omegai \\
    &\int_{\mathbb{R}^3}\Ge\rhoi(y)\diff y  \quad x \in \Omegae
  \end{cases}
\end{equation}
for which we have:\footnote{This can be checked by applying the
differential operators to the definition of $h$ and then swapping
differentiation and integration.}
\begin{equation}
  \begin{cases}
    \nabla^2 h &= \rhoi \,\, \text{in}\,\, \Omegai \\
    \Le h &= 0 \,\, \text{in}\,\, \Omegae
  \end{cases}
\end{equation}
We then define the \emph{reaction potential} as:
\begin{equation}
  \xi = u - h
\end{equation}
such that:
\begin{subequations}
\begin{align}
  \nabla^2 \xi &= 0 \,\, \text{in}\,\, \Omegai \\
  \Le \xi &= 0 \,\, \text{in}\,\, \Omegae \\
  -[\xi] &= [h] \,\, \text{on}\,\, \Gamma \\
  -[\partial_L \xi] &= [\partial_L h] \,\, \text{on}\,\, \Gamma
\end{align}
\end{subequations}
inside the cavity, the reaction potential can be represented by a
\emph{single layer potential}, \ie by an apparent surface charge (ASC):
\begin{equation}
  \xi_\mathrm{i} = \bi{S}_\mathrm{i}\sigma
\end{equation}

Applying Eqs. \eqref{eq:stat3} and \eqref{eq:stat4} of the Lemma of Integral
Representation to the reaction potential yields:
\begin{align}
  \frac{1}{2}\xi_\mathrm{i} &= \bi{S}_\mathrm{i}(\partiali \xi) -
  \bi{D}_\mathrm{i}(\xi_\mathrm{i}) \\
  -\frac{1}{2}\xi_\mathrm{e} &= \bi{S}_\mathrm{e}(\partiale \xi) -
  \bi{D}_\mathrm{e}(\xi_\mathrm{e})
\end{align}
in both cases the last term, including the integration over the entire
subdomain volume, drops out ($f_\mathrm{i} = 0 = f_\mathrm{e}$).
While use of Eq. \eqref{eq:stat4} on the auxiliary potential $h$ yields:
\begin{equation}
  -\frac{1}{2}h_\mathrm{e} =
  \bi{S}_\mathrm{e}(\partiale h) -
  \bi{D}_\mathrm{e}(h_\mathrm{e})
\end{equation}
Together with the jump conditions one obtains:
\begin{subequations}
  \begin{align}
    &\bi{S}_\mathrm{i}(\partiali \xi) - \bi{D}_\mathrm{i}(\xi_\mathrm{i})
    = \frac{1}{2}\xi_\mathrm{i} \label{eq:first} \\
    &\bi{S}_\mathrm{e}(\partiale \xi) - \bi{D}_\mathrm{e}(\xi_\mathrm{e})
    = -\frac{1}{2}\xi_\mathrm{e} \label{eq:second} \\
  &\bi{S}_\mathrm{e}(\partiale h) - \bi{D}_\mathrm{e}(h_\mathrm{e})
  = -\frac{1}{2}h_\mathrm{e} \label{eq:third} \\
  &\xi_\mathrm{i} - \xi_\mathrm{e} = h_\mathrm{e} - h_\mathrm{i}
  \label{eq:fourth} \\
  &\partiali \xi - \partiale \xi = \partiale h - \partiali h
  \label{eq:fifth}
  \end{align}
\end{subequations}

\begin{enumerate}
  \item Add Eqs. \eqref{eq:second} and \eqref{eq:third}:
    \begin{equation}
    \bi{S}_\mathrm{e}(\partiale \xi + \partiale h) -
    \bi{D}_\mathrm{e}(\xi_\mathrm{e} + h_\mathrm{e})
    = -\frac{1}{2}(\xi_\mathrm{e} + h_\mathrm{e})
    \end{equation}
  \item Exploit Eqs. \eqref{eq:fourth} and \eqref{eq:fifth} to
    eliminate the external traces and conormal derivatives:
    \begin{equation}
      \bi{S}_\mathrm{e}(\partiali \xi) + \left(\frac{1}{2} -
      \bi{D}_\mathrm{e}\right)\xi_\mathrm{i} =
      - \bi{S}_\mathrm{e}(\partiali h) - \left(\frac{1}{2} -
      \bi{D}_\mathrm{e}\right)h_\mathrm{i}
    \end{equation}
  \item Introduce the integral representation of
    $\xi_\mathrm{i}$:
    \begin{equation}
      \bi{S}_\mathrm{e}(\partiali \xi) + \left(\frac{1}{2} -
      \bi{D}_\mathrm{e}\right)\bi{S}_\mathrm{i}\sigma =
      - \bi{S}_\mathrm{e}(\partiali h) - \left(\frac{1}{2} -
      \bi{D}_\mathrm{e}\right)h_\mathrm{i}
    \end{equation}
  \item Reorganize Eq. \eqref{eq:first}, using the commutation
    relation and the integral representation of $\xi_\mathrm{i}$:
    \begin{equation}
    \partiali \xi = \left(\frac{1}{2} + \bi{D}^\dagger_\mathrm{i}\right)\sigma
    \end{equation}
    such that:
    \begin{equation}
      \left[ \bi{S}_\mathrm{e}\left(\frac{1}{2} + \bi{D}^\dagger_\mathrm{i}\right)
      +
      \left(\frac{1}{2} - \bi{D}_\mathrm{e}\right)\bi{S}_\mathrm{i}
      \right]\sigma =
      - \bi{S}_\mathrm{e}(\partiali h) - \left(\frac{1}{2} -
      \bi{D}_\mathrm{e}\right)h_\mathrm{i}
    \end{equation}
  \item Employ the \ac{DtN} map to simplify
    the RHS. The \acs{DtN} map is derived by applying Eq. \eqref{eq:stat3} to
    the Newton potential:
    \begin{equation}
      \phi(x) = (\bi{N}\rhoi)(x) = \int_{\mathbb{R}^3}\Gi\rhoi(y)\diff y
      = \left.h(x)\right|_{\Omegai}
    \end{equation}
    which is equal, in $\Omegai$, to the auxiliary potential $h(x)$.
    With this definition one has:
    \begin{equation}
      \frac{1}{2}\phi_\mathrm{i} =
      \bi{S}_\mathrm{i}(\partiali \phi) -
      \bi{D}_\mathrm{i}(\phi_\mathrm{i}) + \int_{\Omegai}\Gi\rhoi(y)\diff y
      =
      \bi{S}_\mathrm{i}(\partiali \phi) -
      \bi{D}_\mathrm{i}(\phi_\mathrm{i}) + \phi_\mathrm{i}
    \end{equation}
    eventually leading to the \acs{DtN} map:
    \begin{equation}\label{eq:regular-DtN}
      \left(\frac{1}{2} - \bi{D}_\mathrm{i}\right)\phi_\mathrm{i}
      +\bi{S}_\mathrm{i}(\partiali \phi) = 0
    \end{equation}
  \item Having identified $\phi_\mathrm{i} \equiv h_\mathrm{i}$
    and $\partiali \phi \equiv \partiali h$ and employing the \acs{DtN} map,
    Eq.\eqref{eq:regular-DtN}, one obtains the \acs{IEF}-\acs{PCM} equation:
    \begin{equation}\label{eq:full-IEF}
      \left[ \bi{S}_\mathrm{e}\left(\frac{1}{2} + \bi{D}^\dagger_\mathrm{i}\right)
      +
      \left(\frac{1}{2} - \bi{D}_\mathrm{e}\right)\bi{S}_\mathrm{i}
      \right]\sigma =
      -\left[\left(\frac{1}{2}-\bi{D}_\mathrm{e}\right)
      -\bi{S}_\mathrm{e}\bi{S}_\mathrm{i}^{-1}
       \left(\frac{1}{2}-\bi{D}_\mathrm{i}\right)
      \right]\phi
    \end{equation}
    where the subscript $\mathrm{i}$ for the Newton potential $\phi$ has
    been dropped, given that it is continuous across the boundary
    $\Gamma$.
\end{enumerate}
The above proves the existence of a representation of the reaction
potential valid \emph{inside} the cavity in terms of an apparent surface
charge density. We do not prove the uniqueness of this solution and
refer the interested reader to the original
paper.~\autocite{Cances1998-og}

In the code, the Green's functions are defined \emph{without} the $4\pi$
factors in the denominator. Instead of $\frac{1}{2}$ as coefficients to
the identity operator, one will then have $2\pi$:
\begin{equation}\label{eq:full-IEF-2pi}
  \left[ \bi{S}_\mathrm{e}\left(2\pi + \bi{D}^\dagger_\mathrm{i}\right)
  +
  \left(2\pi - \bi{D}_\mathrm{e}\right)\bi{S}_\mathrm{i}
  \right]\sigma =
  -\left[\left(2\pi-\bi{D}_\mathrm{e}\right)
  -\bi{S}_\mathrm{e}\bi{S}_\mathrm{i}^{-1}
  \left(2\pi-\bi{D}_\mathrm{i}\right)
  \right]\phi
\end{equation}

From Eq. \eqref{eq:full-IEF-2pi} we can derive the isotropic
\acs{IEF}, the \acs{DPCM} and the \acs{CPCM} (by letting
$\diel\rightarrow\infty$) equations.
For a homogeneous, isotropic dielectric with permittivity $\diel$ the
Green's function outside the cavity is simply given by scaling the one
inside:
\begin{equation}
  \Ge = \frac{1}{\diel|x-y|} = \frac{1}{\diel} \Gi = \frac{1}{|x-y|}
\end{equation}
leading to the boundary integral operators:
\begin{alignat}{2}
  \bi{S}_\mathrm{i} = \diel\bi{S}_\mathrm{e} = \bi{S}, \quad&
  \bi{D}_\mathrm{i} = \bi{D}_\mathrm{e} = \bi{D}
\end{alignat}
Eventually, one has:
\begin{equation}\label{eq:isotropic-IEF}
  \left[ 2\pi \left(\frac{\diel+1}{\diel-1}\right)
  - \bi{D} \right]\bi{S}\sigma
  =
  -\left[2\pi-\bi{D}\right]\phi
\end{equation}
